= Secure Storage Overview

Anypoint Studio 7.10 and earlier versions stored the information of authenticated users in the workspace, meaning that you could have different authenticated users per workspace.

Studio 7.11 introduces a Secure Storage facility to encrypt and save your credentials.

Studio provides a master password provider that automatically generates a master password for all your user credentials. When adding a new credential, Studio uses your master password to encrypt and save that credential into a secure storage file in your file system.

Because of the architecture of the secure storage, the authenticated users are now shared across all Eclipse-based workspaces and Anypoint Studio instances.

== Master Password Providers

The available master password providers depend on your operative system. Studio assigns a priority to the available master password providers and enables you to choose which one to use. By default, Studio assigns a higher level of priority to the password provider that uses your OS's underlying capabilities to generate and encrypt your master password.

When adding a new credential to Studio, it automatically uses the master password generated by the password provider with the highest priority to encrypt your credential, and stores it in a secure storage file located in your filesystem.

Windows Integration (64 bit)::
Available on Windows. This provider uses a random value that is encrypted based on your Windows login information and stored in secure storage. This provider uses the master password automatically to decrypt your credentials.
OS X Keystore Integration::
Available on macOS. This provider uses a random value that is stored in the OS Keychain. You can check it using the Keychain Access utility. This provider uses the master password automatically to decrypt your credentials.
Linux Integration (64 bit)::
Available in Linux. This provider uses a random value and relies on the `libsecret` library that must be present and working on your Linux distribution. This provider uses the master password automatically to decrypt your credentials.
UI Prompt::
Available in Windows, macOS, and Linux. This provider prompts you to create a master password and uses it to encrypt your credentials. This provider requires you to enter your master password every time you open Studio.

When adding a new credential for the first time, Studio notifies you that a new master password has been created. Additionally, Studio prompts you to create two recovery questions to use in case you forget your master password. You must treat the security questions as a second password. If you lose your master password, your security questions are the only other method to recover your credentials.

Each provider supplies its own master password. When you use a provider to encrypt a new credential, you can only use that provider to recover the encrypted credential.

Once a master password is created, Studio caches it until it is closed, or you manually clear the password from Studio's cache.

== Secure Storage File

This file holds all your user credentials in an encrypted form. By default, the secure storage file is located in `$HOME/.eclipse/org.eclipse.equinox.security/secure_storage`.

Because it is a single file, the same secure storage is shared across all Eclipse-based workspaces and Anypoint Studio instances.


== Update the Master Password

You can change or rotate the master password for a particular provider. When changing a master password, all the encrypted data by this provider is re-encrypted with the new master password.

=== Before you Begin

* Ensure that all other instances of Anypoint Studio and any other Eclipse-based application are not running. +
Because the secure storage file is shared across all running instances and the master password is cached in each instance's memory, updating your master password causes other opened instances to still write the credentials using the old master password. Closing all other instances ensures you avoid the <<no-password-provided-exception,No Password Provided Exception>>.

To re-generate your master password:

. Navigate to *Preferences* > *General* > *Security* > *Secure Storage*.
. Select *Change Password...*:
+
image::secure-storage-change-password.png[]
. Studio prompts you to create a password hint for this new password. +
Select *Yes* to generate a new password hint:
+
image::new-password-created.png[]
+
[CAUTION]
--
If you don't supply new password hints, then the former ones persist, which reference the former password. You cannot recover this new password using the previous password hints.
--
. Studio prompts you that the password has been successfully updated.
. Select *Apply and Close*.


== Customize the Location of the Secure Storage and Password Files

To change the location of the password and secure storage files:

. Locate your `AnypointStudio.ini` file:
* In Windows:
.. Go to your Anypoint Studio's installation directory.
* In macOS:
.. Go to your `/Applications` folder, right-click the `AnypointStudio` package and select *Show Package Contents*.
.. Go to `Contents` > `Eclipse`, and open the `AnypointStudio.ini` file.
* In Linux:
.. Go to `/usr/lib/anypointstudio/anypointstudio.ini`.
. Add the following options together to bypass the password provider mechanism:
+
[source]
--
-eclipse.keyring <file_path> //<1>
-eclipse.password <file_path> //<2>
--
<1> Configures the location of the Secure Storage file.
<2> Configures the location of the password file. Studio uses this file's content as the master password.

[CAUTION]
You can only decrypt your credentials with the same password file used to encrypt them.



== Troubleshooting the Secure Storage

[[no-password-provided-exception]]
=== No Password Provided

Exception: `org.eclipse.equinox.security.storage.StorageException: No password provided`

Studio throws this error when it loads and caches the master password for the provider and reads a password in the secure storage that cannot decrypt.

This happens when one instance of Anypoint Studio changes the master password while another instance of Studio saves a new credential using a cached master password.


=== Given Final Block Not Properly Padded

`org.eclipse.equinox.security.storage.StorageException: Given final block not properly padded`.

Studio throws this error when it attempts to use a bad key during decryption.
